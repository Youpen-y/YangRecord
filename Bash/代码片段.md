#### 1. 密码验证
```bash
#!/bin/bash

trap 'stty echo' EXIT   # 确保任何退出都会恢复回显

# `-n` 参数表示不换行（光标停留在冒号后等待输入）
echo -n "Enter password: "
stty -echo  # 禁用终端回显（echo），用户输入的字符不会显示在屏幕上
read password < /dev/tty
stty echo   # 重新启用终端回显
echo ""     # 输出一个换行

# 验证密码
if [[ "$password" == "secret" ]]; then
	echo "Access granted!"
else
	echo "Wrong password."
fi

unset password # 清除密码变量
```

#### 2. trap 命令详解
`trap` 是 Bash 脚本中用于捕获和处理信号的关键命令，能够在脚本执行期间拦截信号（如 `Ctrl+c`、脚本退出等），并执行指定的清理或应急操作，确保脚本安全退出或资源释放。
语法：
```bash
trap 'command1; command2; ...' SIGNAL1 SIGNAL2 ...
```
- `command1; command2; ...`：捕获信号后要执行的命令（可以是函数或代码块）
- `SIGNAL1 SIGNAL2 ...`：要捕获的信号名称或编号（如`EXIT`、`INT`、`TERM`）
常见信号

| ​**​信号​**​ | ​**​编号​**​ | ​**​触发场景​**​        | ​**​默认行为​**​ |
| ---------- | ---------- | ------------------- | ------------ |
| `EXIT`     | `0`        | 脚本正常退出或执行完毕时触发      | 无（自定义清理）     |
| `INT`      | `2`        | 用户按下 `Ctrl+C`（中断）   | 终止脚本         |
| `TERM`     | `15`       | 收到终止请求（如 `kill` 命令） | 终止脚本         |
| `HUP`      | `1`        | 终端挂断（如 SSH 断开连接）    | 终止脚本         |
| `ERR`      | -          | 命令返回非零状态（错误）时触发     | 继续执行         |
使用示例：
1. 捕获 Ctrl + C （`INT` 信号）
```bash
#!/bin/bash

trap 'echo "Interrupted by Ctrl+C! Exiting..."; exit 1' INT

echo "Press Ctrl+C to test the trap."
sleep 10  # 模拟长时间运行
```

2. 脚本退出时自动清理（`EXIT` 信号）
```bash
#!/bin/bash

temp_file="/tmp/example.tmp"
touch "$temp_file"

trap 'rm -f "$temp_file"; echo "Cleaned up temp file."' EXIT

echo "Script is running... (temp file: $temp_file)"
sleep 5
```

3. 同时捕获多个信号
```bash
#!/bin/bash

cleanup() {
	echo "Caught signal! Cleaning up..."
	rm -f /tmp/lockfile
	exit 1
}

trap cleanup INT TERM HUP # 捕获中断、终止和挂断信号

echo "Running...(PID: $$)"  # '$$' 是一个特殊变量，表示当前脚本或 shell 进程的进程 ID（PID）。Bash 内置环境变量

touch /tmp/lockfile
sleep 30
```

4. 捕获命令错误（`ERR` 信号）
```bash
#!/bin/bash

trap 'echo "Error on line $LINENO!"' ERR

nonexistent_command  # 此命令会失败，触发 ERR
echo "This line will not run."
```

5. 动态修改 `trap` 行为
```bash
#!/bin/bash

handler1() { echo "Handler 1"; }
handler2() { echo "Handler 2"; } 
trap handler1 INT
sleep 2 # 此时 Ctrl+C 触发 handler1 
trap handler2 INT 
sleep 2 # 此时 Ctrl+C 触发 handler2
```

6. 恢复默认信号处理域与获取当前 `trap` 设置
```bash
trap - INT  # 恢复 SIGINT 信号的默认行为（终止脚本）
trap -p INT # 查看 SIGINT 信号的当前处理
trap "" HUP # 忽略 SIGHUP 信号
```
注意：在 `trap` 命令执行完后，`$?`（上一个命令的返回码）应当保持不变，也就是保持 `trap` 执行之前的状态。
#### Bash 内置环境变量
1. 脚本与进程控制

| **变量​**​         | ​**​描述​**​                                        | ​**​示例​**​                        |
| ---------------- | ------------------------------------------------- | --------------------------------- |
| `$$`             | 当前 Shell 或脚本的 ​**​进程 ID (PID)​**​                 | `echo "PID: $$"`                  |
| `$BASHPID`       | 当前 Bash 进程的真实 PID（子 Shell 中与 `$$` 不同）             | `(echo "Subshell PID: $BASHPID")` |
| `$PPID`          | 父进程的 PID（调用当前脚本的 Shell 的 PID）                     | `echo "Parent PID: $PPID"`        |
| `$UID` / `$EUID` | 当前用户的 ​**​用户 ID​**​（`$EUID` 是有效用户 ID，受 `sudo` 影响） | `if [ "$EUID" -eq 0 ]; then ...`  |
| `$GROUPS`        | 当前用户所属的 ​**​组 ID 列表​**​                           | `echo "Groups: ${GROUPS[@]}"`     |

2. 脚本参数处理

|​**​变量​**​|​**​描述​**​|​**​示例​**​|
|---|---|---|
|`$0`|当前脚本的名称|`echo "Script name: $0"`|
|`$1`-`$9`|脚本的第 1 到第 9 个参数|`echo "First arg: $1"`|
|`${10}`-`${N}`|第 10 个及以后的参数（需用 `{}` 包裹）|`echo "10th arg: ${10}"`|
|`$#`|传递给脚本的 ​**​参数个数​**​|`if [ "$#" -eq 0 ]; then ...`|
|`$@`|所有参数的列表（每个参数独立）|`for arg in "$@"; do ...`|
|`$*`|所有参数的合并字符串（默认空格分隔）|`echo "Args: $*"`|
|`$_`|上一个命令的最后一个参数（或脚本启动时的绝对路径）|`mkdir dir && cd $_`|
3. 退出状态与错误处理

|**变量​**​|​**​描述​**​|​**​示例​**​|
|---|---|---|
|`$?`|上一个命令的 ​**​退出状态码​**​（0=成功，非0=失败）|`ls /tmp; echo "Status: $?"`|
|`$PIPESTATUS`|管道中​**​所有命令​**​的退出状态（数组形式）|`ls /tmp \| grep foo; echo "${PIPESTATUS[@]}"`|
4. Shell 环境与配置

| ​**​变量​**​      | ​**​描述​**​                  | ​**​示例​**​                           |
| --------------- | --------------------------- | ------------------------------------ |
| `$SHELL`        | 当前用户的默认 Shell 路径            | `echo "Shell: $SHELL"`               |
| `$BASH`         | Bash 解释器的路径                 | `echo "Bash path: $BASH"`            |
| `$BASH_VERSION` | Bash 版本信息                   | `echo "Bash version: $BASH_VERSION"` |
| `$SHLVL`        | Shell 嵌套层级（每启动子 Shell 增加 1） | `echo "Shell level: $SHLVL"`         |
| `$LINENO`       | 当前脚本的​**​行号​**​（用于调试）       | `echo "Error at line $LINENO"`       |
5. 路径与目录管理

| ​**​变量​**​ | ​**​描述​**​             | ​**​示例​**​                     |
| ---------- | ---------------------- | ------------------------------ |
| `$PWD`     | 当前工作目录（绝对路径）           | `echo "Current dir: $PWD"`     |
| `$OLDPWD`  | 上一个工作目录（`cd -` 切换时会用到） | `echo "Previous dir: $OLDPWD"` |
| `$PATH`    | 可执行文件的搜索路径（冒号分隔）       | `echo "PATH: $PATH"`           |
| `$HOME`    | 当前用户的家目录               | `echo "Home dir: $HOME"`       |
6. 终端与交互控制

| ​**​变量​**​            | ​**​描述​**​               | ​**​示例​**​                                |
| --------------------- | ------------------------ | ----------------------------------------- |
| `$TERM`               | 终端类型（如 `xterm-256color`） | `echo "Terminal type: $TERM"`             |
| `$COLUMNS` / `$LINES` | 终端的列数和行数（窗口大小）           | `echo "Terminal size: $COLUMNS x $LINES"` |
| `$PS1`                | 主命令提示符（可自定义）             | `echo "Prompt: $PS1"`                     |
7. 其他实用变量

|​**​变量​**​|​**​描述​**​|​**​示例​**​|
|---|---|---|
|`$RANDOM`|生成随机数（0-32767）|`echo "Random: $RANDOM"`|
|`$SECONDS`|脚本已运行的秒数|`echo "Runtime: $SECONDS seconds"`|
|`$IFS`|输入字段分隔符（默认是空格、制表符、换行符）|`IFS=',' read -a arr <<< "a,b,c"`|

#### 4. 变量操作技巧
1. 默认值赋值
```bash
# 如果变量未定义，使用默认值
echo "${VAR:-default_value}"
```

2. 检查变量是否为空
```bash
if [ -z "$VAR" ]; then
	echo "Variable is empty"
fi
```

3. 获取变量长度
```bash
str="hello"
echo "Length: ${#str}"  # 输出 5
```