一个URL由访问协议、服务器域名、请求文件（资源的）路径名组成。
![[URL组成.png]]
因此第一步：浏览器解析URL中的参数，将域名和需要请求的资源分离开来，从而了解需要请求的是哪个服务器，请求的是服务器上什么资源等。![[Pasted image 20250415184754.png]]
解析URL之后，浏览器确定了目标服务器和文件名，之后就根据这些消息封装成一个 HTTP 请求报文发送出去。
请求报文通常包括请求行、请求头和请求体
![[HTTP请求报文.png]]
第三步，在封装好 HTTP 请求报文后，需要获取目标服务器的 IP 地址。进行域名解析：从域名转换得到 IP 地址就 DNS 协议所做的事情。
1. 首先搜索**浏览器的 DNS 缓存**，缓存中维护着一张域名与 IP 地址的对应表。
2. 若没有命中，则继续搜索**操作系统的 DNS 缓存**。
3. 若仍然没有命中，则操作系统将域名发送至**本地域名服务器**，本地域名服务器查询自己的 DNS 缓存，查找成功则返回结果。（主机和本地域名服务器之间的查询方式是递归查询）
4. 若本地域名服务器的 DNS 缓存没有命中，则本地域名服务器向上级域名服务器进行查询，通过以下方式进行迭代查询（Note：本地域名服务器和其他域名服务器之间的查询方式是迭代查询，防止根域名服务器压力过大）
    1. 首先本地域名服务器向根域名服务器发起请求，根域名服务器是最高层次的，它并不会直接指明这个域名对应的 IP 地址，而是返回顶级域名服务器的地址，也就是说给本地域名服务器指明一条道路，让他去这里寻找答案
    2. 本地域名服务器拿到这个顶级域名服务器的地址后，就向其发起请求，获取权限域名服务器的地址
    3. 本地域名服务器根据权限域名服务器的地址后，就向其发起请求，最终得到该域名对应的IP地址
    4. 本地域名服务器将得到的 IP 地址返回给操作系统，同时自己将 IP 地址缓存起来       
    5. 操作系统将 IP 地址返回给浏览器，同时自己也将 IP 地址缓存起来
    6. 至此，浏览器就得到了域名对应的 IP 地址，并将 IP 地址缓存起来
![[DNS 解析.png]]
需要注意的是，DNS 使用的是 UDP 协议，即上面各种请求的转发，都是基于UDP这个无连接协议。
5. 建立 TCP 连接
获取到目标服务器 IP 地址之后，浏览器就知道请求应该发给谁，因此封装 HTTP 请求报文。既然需要发送请求，必然就需要 TCP 通过三次握手为浏览器和服务器之间建立可靠连接。保证双方都具有可靠的接收和发送能力。
6. 浏览器发送请求
TCP 三次握手后，浏览器与目标服务器之间就建立了一个可靠的虚拟通道，于是浏览器就可以发送自己的HTTP请求了。需要注意的是，HTTP 请求报文或者响应报文在 TCP 连接通道上进行传输的时候，由于这些报文比较大，为了更容易和准确可靠的传输，TCP 会将 HTTP 报文按序号分割成若干报文段并加上 TCP 首部，分别进行传输。接收方在收到这些报文段后，按照序号以原来的顺序重组 HTTP 报文
7. 负责传输的 IP 协议
TCP 在三次握手建立连接、四次握手断开连接、以及连接建立过程中的收发数据（TCP 报文段）等各阶段操作时，都是通过 IP 协议进行传输的，IP 协议将这些阶段的数据添加 IP 首部封装成 IP 数据报再进行传输。
IP 数据报的首部存有源 IP 地址和 目标 IP 地址。所谓源 IP 地址 就是发送方的 IP 地址；目标 IP 地址就是通过 DNS 域名解析得到的目标服务器的 IP 地址。
事实上，IP 协议身处的网络层规定的是：数据报要通过怎样的路径（传输路线）才能到达对方计算机，并传送给对方。不理解这句话的详细解释马上就来，继续往下读。
8. 使用 ARP 协议凭借 MAC 地址通信
ARP 协议：将 IP 地址转化为 MAC 地址，从而在数据链路层精确的传输数据的协议。
ARP 是借助 ARP 请求与 ARP 响应两种类型的包确定 MAC 地址的。并且每个主机都有一个 ARP 高速缓存，里面有本局域网上的各主机和路由器的 IP 地址到 MAC 地址的映射表。
9. 服务器响应请求
浏览器的 HTTP 请求报文通过 TCP 三次握手建立的连接通道被切分成若干报文段分别发送给服务器，服务器在收到这些报文段后，按照序号以原来的顺序重组 HTTP 请求报文。然后处理并返回一个 HTTP 响应。当然，HTTP 响应报文也要经过和 HTTP 请求报文一样的过程。
10. 断开 TCP 连接
浏览器和服务器都不再需要发送数据后，四次挥手断开 TCP 连接。
11. 浏览器显示界面
浏览器接收到服务器返回的数据包，根据浏览器的渲染机制对相应的数据进行渲染。




